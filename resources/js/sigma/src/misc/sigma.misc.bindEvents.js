(function(N){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.misc"),sigma.misc.bindEvents=function(k){var t,e,x,y,C=this;function f(t){t&&(x="x"in t.data?t.data.x:x,y="y"in t.data?t.data.y:y);var e,a,i,d,n,s,o,c,r=[],g=x+C.width/2,h=y+C.height/2,l=C.camera.cameraPosition(x,y),p=C.camera.quadtree.point(l.x,l.y);if(p.length)for(e=0,i=p.length;e<i;e++)if(n=(d=p[e])[k+"x"],s=d[k+"y"],o=d[k+"size"],!d.hidden&&n-o<g&&g<n+o&&s-o<h&&h<s+o&&Math.sqrt(Math.pow(g-n,2)+Math.pow(h-s,2))<o){for(c=!1,a=0;a<r.length;a++)if(d.size>r[a].size){r.splice(a,0,d),c=!0;break}c||r.push(d)}return r}function m(t){if(!C.settings("enableEdgeHovering"))return[];var e=sigma.renderers.canvas&&C instanceof sigma.renderers.canvas;if(!e)throw new Error("The edge events feature is not compatible with the WebGL renderer");t&&(x="x"in t.data?t.data.x:x,y="y"in t.data?t.data.y:y);var a,i,d,n,s,o,c,r,g,h,l=C.settings("edgeHoverPrecision"),p={},u=[],v=x+C.width/2,E=y+C.height/2,f=C.camera.cameraPosition(x,y),m=[];if(e)for(a=0,d=(n=C.camera.quadtree.area(C.camera.getRectangle(C.width,C.height))).length;a<d;a++)p[n[a].id]=n[a];function b(t,e){for(h=!1,i=0;i<t.length;i++)if(e.size>t[i].size){t.splice(i,0,e),h=!0;break}h||t.push(e)}if(C.camera.edgequadtree!==N&&(m=C.camera.edgequadtree.point(f.x,f.y)),m.length)for(a=0,d=m.length;a<d;a++)s=m[a],c=C.graph.nodes(s.source),r=C.graph.nodes(s.target),o=s[k+"size"]||s["read_"+k+"size"],!s.hidden&&!c.hidden&&!r.hidden&&(!e||p[s.source]||p[s.target])&&sigma.utils.getDistance(c[k+"x"],c[k+"y"],v,E)>c[k+"size"]&&sigma.utils.getDistance(r[k+"x"],r[k+"y"],v,E)>r[k+"size"]&&("curve"==s.type||"curvedArrow"==s.type?c.id===r.id?(g=sigma.utils.getSelfLoopControlPoints(c[k+"x"],c[k+"y"],c[k+"size"]),sigma.utils.isPointOnBezierCurve(v,E,c[k+"x"],c[k+"y"],r[k+"x"],r[k+"y"],g.x1,g.y1,g.x2,g.y2,Math.max(o,l))&&b(u,s)):(g=sigma.utils.getQuadraticControlPoint(c[k+"x"],c[k+"y"],r[k+"x"],r[k+"y"]),sigma.utils.isPointOnQuadraticCurve(v,E,c[k+"x"],c[k+"y"],r[k+"x"],r[k+"y"],g.x,g.y,Math.max(o,l))&&b(u,s)):sigma.utils.isPointOnSegment(v,E,c[k+"x"],c[k+"y"],r[k+"x"],r[k+"y"],Math.max(o,l))&&b(u,s));return u}function a(t){var p,u,v={},E={};function e(t){if(C.settings("eventsEnabled")){p=f(t),u=m(t);var e,a,i,d,n=[],s=[],o={},c=p.length,r=[],g=[],h={},l=u.length;for(e=0;e<c;e++)o[(i=p[e]).id]=i,v[i.id]||(s.push(i),v[i.id]=i);for(a in v)o[a]||(n.push(v[a]),delete v[a]);for(e=0,c=s.length;e<c;e++)C.dispatchEvent("overNode",{node:s[e],captor:t.data});for(e=0,c=n.length;e<c;e++)C.dispatchEvent("outNode",{node:n[e],captor:t.data});for(s.length&&C.dispatchEvent("overNodes",{nodes:s,captor:t.data}),n.length&&C.dispatchEvent("outNodes",{nodes:n,captor:t.data}),e=0;e<l;e++)h[(d=u[e]).id]=d,E[d.id]||(g.push(d),E[d.id]=d);for(a in E)h[a]||(r.push(E[a]),delete E[a]);for(e=0,l=g.length;e<l;e++)C.dispatchEvent("overEdge",{edge:g[e],captor:t.data});for(e=0,l=r.length;e<l;e++)C.dispatchEvent("outEdge",{edge:r[e],captor:t.data});g.length&&C.dispatchEvent("overEdges",{edges:g,captor:t.data}),r.length&&C.dispatchEvent("outEdges",{edges:r,captor:t.data})}}t.bind("click",function(t){C.settings("eventsEnabled")&&(C.dispatchEvent("click",t.data),p=f(t),u=m(t),p.length?(C.dispatchEvent("clickNode",{node:p[0],captor:t.data}),C.dispatchEvent("clickNodes",{node:p,captor:t.data})):u.length?(C.dispatchEvent("clickEdge",{edge:u[0],captor:t.data}),C.dispatchEvent("clickEdges",{edge:u,captor:t.data})):C.dispatchEvent("clickStage",{captor:t.data}))}),t.bind("mousedown",e),t.bind("mouseup",e),t.bind("mousemove",e),t.bind("mouseout",function(t){if(C.settings("eventsEnabled")){var e,a,i,d,n=[],s=[];for(e in v)n.push(v[e]);for(v={},a=0,i=n.length;a<i;a++)C.dispatchEvent("outNode",{node:n[a],captor:t.data});for(n.length&&C.dispatchEvent("outNodes",{nodes:n,captor:t.data}),E={},a=0,d=s.length;a<d;a++)C.dispatchEvent("outEdge",{edge:s[a],captor:t.data});s.length&&C.dispatchEvent("outEdges",{edges:s,captor:t.data})}}),t.bind("doubleclick",function(t){C.settings("eventsEnabled")&&(C.dispatchEvent("doubleClick",t.data),p=f(t),u=m(t),p.length?(C.dispatchEvent("doubleClickNode",{node:p[0],captor:t.data}),C.dispatchEvent("doubleClickNodes",{node:p,captor:t.data})):u.length?(C.dispatchEvent("doubleClickEdge",{edge:u[0],captor:t.data}),C.dispatchEvent("doubleClickEdges",{edge:u,captor:t.data})):C.dispatchEvent("doubleClickStage",{captor:t.data}))}),t.bind("rightclick",function(t){C.settings("eventsEnabled")&&(C.dispatchEvent("rightClick",t.data),p=f(t),u=m(t),p.length?(C.dispatchEvent("rightClickNode",{node:p[0],captor:t.data}),C.dispatchEvent("rightClickNodes",{node:p,captor:t.data})):u.length?(C.dispatchEvent("rightClickEdge",{edge:u[0],captor:t.data}),C.dispatchEvent("rightClickEdges",{edge:u,captor:t.data})):C.dispatchEvent("rightClickStage",{captor:t.data}))}),C.bind("render",e)}for(t=0,e=this.captors.length;t<e;t++)a(this.captors[t])}}).call(this);