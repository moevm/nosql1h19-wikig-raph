(function(o){"use strict";var h={},c=function(e){var r,i,t,s,n;c.classes.dispatcher.extend(this);var d=this,a=e||{};if("string"==typeof a||a instanceof HTMLElement?a={renderers:[a]}:"[object Array]"===Object.prototype.toString.call(a)&&(a={renderers:a}),s=a.renderers||a.renderer||a.container,a.renderers&&0!==a.renderers.length||("string"==typeof s||s instanceof HTMLElement||"object"==typeof s&&"container"in s)&&(a.renderers=[s]),a.id){if(h[a.id])throw'sigma: Instance "'+a.id+'" already exists.';Object.defineProperty(this,"id",{value:a.id})}else{for(n=0;h[n];)n++;Object.defineProperty(this,"id",{value:""+n})}for((h[this.id]=this).settings=new c.classes.configurable(c.settings,a.settings||{}),Object.defineProperty(this,"graph",{value:new c.classes.graph(this.settings),configurable:!0}),Object.defineProperty(this,"middlewares",{value:[],configurable:!0}),Object.defineProperty(this,"cameras",{value:{},configurable:!0}),Object.defineProperty(this,"renderers",{value:{},configurable:!0}),Object.defineProperty(this,"renderersPerCamera",{value:{},configurable:!0}),Object.defineProperty(this,"cameraFrames",{value:{},configurable:!0}),Object.defineProperty(this,"camera",{get:function(){return this.cameras[0]}}),Object.defineProperty(this,"events",{value:["click","rightClick","clickStage","doubleClickStage","rightClickStage","clickNode","clickNodes","doubleClickNode","doubleClickNodes","rightClickNode","rightClickNodes","overNode","overNodes","outNode","outNodes","downNode","downNodes","upNode","upNodes"],configurable:!0}),this._handler=function(e){var r,i={};for(r in e.data)i[r]=e.data[r];i.renderer=e.target,this.dispatchEvent(e.type,i)}.bind(this),r=0,i=(t=a.renderers||[]).length;r<i;r++)this.addRenderer(t[r]);for(r=0,i=(t=a.middlewares||[]).length;r<i;r++)this.middlewares.push("string"==typeof t[r]?c.middlewares[t[r]]:t[r]);"object"==typeof a.graph&&a.graph&&(this.graph.read(a.graph),this.refresh()),window.addEventListener("resize",function(){d.settings&&d.refresh()})};if(c.prototype.addCamera=function(e){var r,i=this;if(!arguments.length){for(e=0;this.cameras[""+e];)e++;e=""+e}if(this.cameras[e])throw'sigma.addCamera: The camera "'+e+'" already exists.';return r=new c.classes.camera(e,this.graph,this.settings),(this.cameras[e]=r).quadtree=new c.classes.quad,c.classes.edgequad!==o&&(r.edgequadtree=new c.classes.edgequad),r.bind("coordinatesUpdated",function(e){i.renderCamera(r,r.isAnimated)}),this.renderersPerCamera[e]=[],r},c.prototype.killCamera=function(e){if(!(e="string"==typeof e?this.cameras[e]:e))throw"sigma.killCamera: The camera is undefined.";var r,i=this.renderersPerCamera[e.id];for(r=i.length-1;0<=r;r--)this.killRenderer(i[r]);return delete this.renderersPerCamera[e.id],delete this.cameraFrames[e.id],delete this.cameras[e.id],e.kill&&e.kill(),this},c.prototype.addRenderer=function(e){var r,i,t,s,n=e||{};if("string"==typeof n?n={container:document.getElementById(n)}:n instanceof HTMLElement&&(n={container:n}),"string"==typeof n.container&&(n.container=document.getElementById(n.container)),"id"in n)r=n.id;else{for(r=0;this.renderers[""+r];)r++;r=""+r}if(this.renderers[r])throw'sigma.addRenderer: The renderer "'+r+'" already exists.';if(i=(i="function"==typeof n.type?n.type:c.renderers[n.type])||c.renderers.def,t="camera"in n?n.camera instanceof c.classes.camera?n.camera:this.cameras[n.camera]||this.addCamera(n.camera):this.addCamera(),this.cameras[t.id]!==t)throw"sigma.addRenderer: The camera is not properly referenced.";return s=new i(this.graph,t,this.settings,n),this.renderers[r]=s,Object.defineProperty(s,"id",{value:r}),s.bind&&s.bind(["click","rightClick","clickStage","doubleClickStage","rightClickStage","clickNode","clickNodes","clickEdge","clickEdges","doubleClickNode","doubleClickNodes","doubleClickEdge","doubleClickEdges","rightClickNode","rightClickNodes","rightClickEdge","rightClickEdges","overNode","overNodes","overEdge","overEdges","outNode","outNodes","outEdge","outEdges","downNode","downNodes","downEdge","downEdges","upNode","upNodes","upEdge","upEdges"],this._handler),this.renderersPerCamera[t.id].push(s),s},c.prototype.killRenderer=function(e){if(!(e="string"==typeof e?this.renderers[e]:e))throw"sigma.killRenderer: The renderer is undefined.";var r=this.renderersPerCamera[e.camera.id],i=r.indexOf(e);return 0<=i&&r.splice(i,1),e.kill&&e.kill(),delete this.renderers[e.id],this},c.prototype.refresh=function(e){var r,i,t,s,n,d,a=0;for(e=e||{},r=0,i=(s=this.middlewares||[]).length;r<i;r++)s[r].call(this,0===r?"":"tmp"+a+":",r===i-1?"ready:":"tmp"+ ++a+":");for(t in this.cameras)(n=this.cameras[t]).settings("autoRescale")&&this.renderersPerCamera[n.id]&&this.renderersPerCamera[n.id].length?c.middlewares.rescale.call(this,s.length?"ready:":"",n.readPrefix,{width:this.renderersPerCamera[n.id][0].width,height:this.renderersPerCamera[n.id][0].height}):c.middlewares.copy.call(this,s.length?"ready:":"",n.readPrefix),e.skipIndexation||(d=c.utils.getBoundaries(this.graph,n.readPrefix),n.quadtree.index(this.graph.nodes(),{prefix:n.readPrefix,bounds:{x:d.minX,y:d.minY,width:d.maxX-d.minX,height:d.maxY-d.minY}}),n.edgequadtree!==o&&n.settings("drawEdges")&&n.settings("enableEdgeHovering")&&n.edgequadtree.index(this.graph,{prefix:n.readPrefix,bounds:{x:d.minX,y:d.minY,width:d.maxX-d.minX,height:d.maxY-d.minY}}));for(r=0,i=(s=Object.keys(this.renderers)).length;r<i;r++)if(this.renderers[s[r]].process)if(this.settings("skipErrors"))try{this.renderers[s[r]].process()}catch(e){console.log('Warning: The renderer "'+s[r]+'" crashed on ".process()"')}else this.renderers[s[r]].process();return this.render(),this},c.prototype.render=function(){var r,e,i;for(r=0,e=(i=Object.keys(this.renderers)).length;r<e;r++)if(this.settings("skipErrors"))try{this.renderers[i[r]].render()}catch(e){this.settings("verbose")&&console.log('Warning: The renderer "'+i[r]+'" crashed on ".render()"')}else this.renderers[i[r]].render();return this},c.prototype.renderCamera=function(e,r){var i,t,s,n=this;if(r)for(i=0,t=(s=this.renderersPerCamera[e.id]).length;i<t;i++)if(this.settings("skipErrors"))try{s[i].render()}catch(e){this.settings("verbose")&&console.log('Warning: The renderer "'+s[i].id+'" crashed on ".render()"')}else s[i].render();else if(!this.cameraFrames[e.id]){for(i=0,t=(s=this.renderersPerCamera[e.id]).length;i<t;i++)if(this.settings("skipErrors"))try{s[i].render()}catch(e){this.settings("verbose")&&console.log('Warning: The renderer "'+s[i].id+'" crashed on ".render()"')}else s[i].render();this.cameraFrames[e.id]=requestAnimationFrame(function(){delete n.cameraFrames[e.id]})}return this},c.prototype.kill=function(){var e;for(e in this.dispatchEvent("kill"),this.graph.kill(),delete this.middlewares,this.renderers)this.killRenderer(this.renderers[e]);for(e in this.cameras)this.killCamera(this.cameras[e]);for(e in delete this.renderers,delete this.cameras,this)this.hasOwnProperty(e)&&delete this[e];delete h[this.id]},c.instances=function(e){return arguments.length?h[e]:c.utils.extend({},h)},c.version="1.2.1",void 0!==this.sigma)throw"An object called sigma is already in the global scope.";this.sigma=c}).call(this);